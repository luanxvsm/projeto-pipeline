name: Pipeline com SAST e DAST

on:
  push:
    branches:
      - main
      - develop
  pull_request:

jobs:
  build:
    name: üèóÔ∏è Build e Valida√ß√£o B√°sica
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Verifica se o arquivo projeto.txt existe
        run: |
          if [ -f "projeto.txt" ]; then
            echo "‚úÖ Arquivo projeto.txt encontrado!"
          else
            echo "‚ùå Arquivo projeto.txt n√£o encontrado!"
            exit 1
          fi

      - name: Exibe o conte√∫do do arquivo
        run: cat projeto.txt

  sast:
    name: üß© SAST - An√°lise Est√°tica de Seguran√ßa
    runs-on: ubuntu-latest
    needs: build   # S√≥ roda depois do build
    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Simula√ß√£o de varredura SAST
        run: |
          echo "üîç Iniciando an√°lise SAST (est√°tica)..."
          # Exemplo simb√≥lico de busca por c√≥digo inseguro
          if grep -q "senha" projeto.txt; then
            echo "‚ùå Vulnerabilidade detectada: palavra 'senha' encontrada!"
            exit 1
          else
            echo "‚úÖ Nenhum problema de seguran√ßa est√°tico encontrado."
          fi

  dast:
    name: üß™ DAST - Teste Din√¢mico de Seguran√ßa
    runs-on: ubuntu-latest
    needs: sast   # S√≥ roda ap√≥s o SAST
    steps:
      - name: Simula√ß√£o de varredura DAST
        run: |
          echo "üåê Iniciando an√°lise DAST (din√¢mica)..."
          # Aqui poder√≠amos rodar algo como OWASP ZAP (simula√ß√£o)
          # Vamos apenas simular uma verifica√ß√£o de vulnerabilidade
          RESPONSE_CODE=200
          if [ "$RESPONSE_CODE" -eq 200 ]; then
            echo "‚úÖ Aplica√ß√£o respondeu corretamente. Nenhuma vulnerabilidade cr√≠tica encontrada."
          else
            echo "‚ùå Falha detectada na resposta da aplica√ß√£o!"
            exit 1
          fi
